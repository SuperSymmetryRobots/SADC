<!-- -->
<launch>

  <arg name="name"  default="seat_car"/>
  <arg name="model" default="car"/>
  <arg name="x"     default="0.0"/>
  <arg name="y"     default="0.0"/>
  <arg name="yaw"   default="0.0"/>

  <arg name="world_frame" default="world"/>
  <arg name="map_frame"   default="map"/>
  <arg name="odom_frame"  default="odom"/>

  <include file="$(find seat_car_description)/launch/description.launch">
    <arg name="name"  value="$(arg name)"/>
    <arg name="model" value="$(arg model)"/>
  </include>

  <node name="spawn_urdf_$(arg name)"
        pkg ="gazebo_ros"
        type="spawn_model" 
        args="-param robot_description
              -urdf -model $(arg name)
              -x $(arg x) -y $(arg y) -z 0.04 -R 0 -P 0 -Y $(arg yaw) "/>

  <include file="$(find seat_car_control)/launch/control.launch">
    <arg name="name" value="$(arg name)"/>
  </include>
  
  <node pkg ="odometry" 
        type="odometry_publisher" 
        name="odometry_publisher"
        output="screen">
    <remap from="/motor_control/twist"
             to="/model_car/twist"/>
    <remap from="/model_car/yaw"
             to="/model_car/yaw"/>
  </node>
  
  <node name="imu_filter"
        pkg ="imu_filter_madgwick"
        type="imu_filter_node"
        output="screen">
    <remap from="/imu/data_raw"
             to="/imu"/>
    <param name="use_mag" value="false"/>
    <param name="gain" value="0.1"/>
    <param name="zeta" value="0.0"/>
    <param name="mag_bias_x" value="0.0"/>
    <param name="mag_bias_y" value="0.0"/>
    <param name="mag_bias_z" value="0.0"/>
    <param name="orientation_stddev" value="0.0"/>
    <param name="world_frame" value="nwu"/>
    <param name="use_magnetic_field_msg" value="false"/>
    <param name="fixed_frame" value="/$(arg name)/imu"/>
    <param name="publish_tf" value="false"/>
    <param name="reverse_tf" value="false"/>
    <param name="constant_dt" value="0.0"/>
    <param name="publish_debug_topics" value="false"/>
    <param name="stateless" value="false"/>
  </node>

  <node name="$(arg name)_static_tf_world_map" pkg="tf" type="static_transform_publisher"
        args="0 0 0 0 0 0 $(arg world_frame) $(arg map_frame) 100"/>

  <!-- replace with localization node -->
  <node name="$(arg name)_static_tf_map_odom" pkg="tf" type="static_transform_publisher"
        args="$(arg x) $(arg y) 0.04 $(arg yaw) 0 0 $(arg map_frame) $(arg odom_frame) 100"/>

</launch>